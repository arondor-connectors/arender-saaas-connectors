(function(){Alfresco.module.CompareVersion=function(containerId){this.name="Alfresco.module.CompareVersion";this.id=containerId;var instance=Alfresco.util.ComponentManager.get(this.id);if(instance!==null){throw new Error("An instance of Alfresco.module.CompareVersion already exists.");}Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require(["button","container","datatable","datasource"],this.onComponentsLoaded,this);return this;};Alfresco.module.CompareVersion.prototype={defaultShowConfig:{nodeRef:null,filename:null,version:null,onCompareVersionComplete:null},showConfig:{},widgets:{},onComponentsLoaded:function CV_onComponentsLoaded(){if(this.id===null){return;}},show:function CV_show(config){this.showConfig=YAHOO.lang.merge(this.defaultShowConfig,config);if(this.showConfig.nodeRef===undefined&&this.showConfig.filename===undefined&&this.showConfig.version===undefined){throw new Error("A nodeRef, filename and version must be provided");}Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"modules/document-details/compare-version?htmlid="+this.id+"&nodeRef="+this.showConfig.nodeRef+"&version="+this.showConfig.version,successCallback:{fn:this.onTemplateLoaded,scope:this},failureMessage:"Could not load html compare template",execScripts:true});},onTemplateLoaded:function CV_onTemplateLoaded(response){var Dom=YAHOO.util.Dom;var containerDiv=document.createElement("div");containerDiv.innerHTML=response.serverResponse.responseText;var dialogDiv=YAHOO.util.Dom.getFirstChild(containerDiv);this.widgets.panel=Alfresco.util.createYUIPanel(dialogDiv);this.widgets.headerText=Dom.get(this.id+"-header-span");this.widgets.targetversion=YAHOO.util.Dom.get(this.id+"-targetversion-dropdown");this.widgets.okButton=Alfresco.util.createYUIButton(this,"ok-button",this.onOKButtonClick);this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel-button",this.onCancelButtonClick);this._showPanel();},onCancelButtonClick:function RV_onCancelButtonClick(){this.widgets.panel.hide();},onOKButtonClick:function RV_onOKButtonClick(){this.widgets.panel.hide();var nodeRefs=this.showConfig.nodeRef+";"+this.showConfig.version+","+this.showConfig.nodeRef+";"+this.widgets.targetversion.value;window.open(Alfresco.constants.PROXY_URI+"/arender/doclib/action/compare?noderefs="+nodeRefs,"_blank");},_applyConfig:function RV__applyConfig(){var Dom=YAHOO.util.Dom;var header=Alfresco.util.message("header.compareversions",this.name,{"0":this.showConfig.filename,"1":this.showConfig.version});this.widgets.headerText.innerHTML=header;this.widgets.cancelButton.set("disabled",false);},_showPanel:function RV__showPanel(){this._applyConfig();this.widgets.panel.show();}};})();Alfresco.module.getCompareVersionInstance=function(){var instanceId="alfresco-compareVersion-instance";return Alfresco.util.ComponentManager.get(instanceId)||new Alfresco.module.CompareVersion(instanceId);};